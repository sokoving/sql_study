# TCL (Transaction Control Language, 트랜젝션 제어어)
- ACID : [원자성 Atomicity], [일관성 Consistency], [고립성 Isolation], [지속성 Durability]
- [COMMIT], [ROLLBACK]
- DML에 의해 조작된 결과를 트랜젝션 단위로 적용(COMMIT), 취소(ROLLBACK)하는 명령어

------------------------------------------------------------------

## 1. 트랜젝션의 특성
- 데이터베이스의 논리적 연산단위
- 하나의 트랜잭션에는 하나 이상의 SQL 문장이 포함된다

### ACID
- *원자성 Atomicity*
 + 트랜잭션은 분할할 수 없는 최소단위이기 때문에
 + 전부 적용할 수 없다면 전부 취소한다 (All or Nothing)
- *일관성 Consistency*
 + 트랜잭션 실행되기 전에 데이터베이스의 내용에 오류가 없다면
 + 실행된 이후의 데이터베이스의 내용에도 오류가 없어야 한다
- *고립성 Isolation*
 + 트랜잭션이 실행되는 중에 다른 트랜잭션의 영향을 받아
 + 잘못된 결과가 도출되서는 안 된다
- *지속성 Durability*
 + 트랜잭션이 성공적으로 수행되면
 + 그 트랜잭션이 갱신한 데이터베이스의 내용은 영구적으로 저장된다

------------------------------------------------------------------

## 2. COMMIT : 트랜잭션 완료
- 입력, 수정, 삭제한 자료에 대해서 문제가 없다고 판단할 경우
- COMMIT 명령어를 통해 트랜잭션을 완료한다
```
COMMIT;
```

### COMMIT 이전
- 데이터 변경 이전 상태
- 복구(ROLLBACK)가 가능하다
- 현재 사용자는 SELECT문으로 결과 확인 가능
 + 다른 사용자는 확인 못 함
- 변경된 행은 잠금(LOKING)이 설정되면서
 + 다른 사용자가 데이터를 변경할 수 없다

### COMMIT 이후
- 데이터 변경 사항이 데이터베이스에 반영
- 이전 데이터는 영원히 잃어버리게 된다
- 모든 사용자가 결과 확인 가능
- 관련 행에 대한 잠금(LOKING)이 풀리고
 + 다른 사용자가 데이터를 변경할 수 있게 된다

------------------------------------------------------------------

## 3. ROLLBACK : 변경 사항 취소
- 입력, 삭제, 수정 등 변경한 데이터를 최신 커밋 상태로 되돌려놓는 것
- 커밋한 데이터는 롤백할 수 없다
 ```
ROLLBACK;
```

## 롤백 이후
- 데이터의 변경 사항이 취소
- 데이터가 이전 상태로 복구
- 관련ㄷ 행에 대한 잠금이 풀리고
 + 다른 사용자가 데이터를 변경할 수 있게 된다

------------------------------------------------------------------

## 4. SAVE POINT : 저장점 정의
- 현 시점부터 세이브 포인트 중에서 트랜잭션의 일부만 롤백할 수 있다
- 복잡한 대규모 트랜잭션에서 에러가 발생했을 때
 + 세이브 포인트까지만 되돌리고 실패한 부분에 대해서만 다시 실행할 수 잇게 한다
```
SAVEPOINT sv1;

INSERT INTO tb_certi (certi_cd, certi_nm) VALUES ('100022', 'SQL강의자', '정보보호학원);
UPDATE tb_certi SET certi_nm = 'SQL경험보유자' WHERE certi_cd = '100022';

ROLLBACK TO sv1; -- sv1로 롤백, INSERT, UPDATE는 롤백

DELETE FROM tb_certi WHERE certi_cd = '100022' -- 롤백 > 100022 데이터는 존재하지 않음
```
------------------------------------------------------------------

## 5. 정리
- 테이블 데이터가 변경되는 insert, update, delete 수행 시
 + 변경되는 데이터의 *무결성을 보장*하는 것이 커밋과 롤백의 목적
- 커밋: 변경된 데이터를 테이블에 영구적으로 반영해라
- 롤백: 변경 전으로 돌아가라
- 세이브 포인트: 데이터 변경을 사전에 지정한 저장점까지만 롤백해라
- 트랜젝션은 SQL 문장을 실행하면 자동 시작하고
 + 커밋, 롤백을 실행한 시점에서 종료

## 6. 자동 커밋
1. DDL 문장 실행 시 전후로 자동 커밋
  + CREATE, ALTER, DROP, RENAME, TRUNCATE TABLE
2. DML 문장 이후 커밋 없이 DDL 문장 실행 시
 DDL 수행 전에 자동 커밋
3. 데이터베이스 정상 접속 종료 시 자동 커밋
 + 비정상 접속 중단 시 자동 롤백
