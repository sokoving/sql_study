# 서브쿼리 (Subquery)
- 하나의 SQL문 안에 포함되어 있는 또다른 SQL문
## 컬럼 사용 범위
 + 조인 : 조인에 참여한 테이블의 컬럼은 어느 위치에서든지 사용할 수 있다
 + 서브쿼리 : 메인 쿼리의 컬럼을 모두 사용할 수 있다
 + 메인 쿼리 : 서브쿼리의 컬럼을 사용할 수 없다
## 서브쿼리 주의점
- 서브쿼리는 괄호로 감싸서 사용
- 비교연산자와 함께 사용 가능
- ORDER BY는 메인 쿼리의 마지막 문장에 위치
 + 서브쿼리에서는 ORDER BY 사용 불가
## 서브쿼리 사용 위치
1. SELECT문 : SELECT, FROM, WHERE, HAVING, ORDER BY
2. INSERT문 : VALUES,
3. UPDATE문 : SET

## 서브쿼리의 종류
1. 동작방식에 따른 분류
```비연관 서브쿼리
   - 서브쿼리가 메인쿼리의 컬럼을 가지고 있지 않음
   - 메인쿼리에 값을 제공하기 위해 사용
```
```연관 서브쿼리
   - 서브쿼리가 메인쿼리의 컬럼을 가지고 있음
   - 메인쿼리가 먼저 수행된 뒤 읽힌 데이터를 
     서브쿼리에서 조건이 맞는지 확인할 때 주로 사용
```
2. 반환 형태에 따른 분류
```단일행 서브쿼리
   - 서브쿼리의 조회 결과가 1건(1행) 이하인 경우
   - 단일행 비교연산자와 함께 사용 (다중행과 쓰면 에러)
     =, <>, <, <=, >, >=
```
```다중행 서브쿼리
   - 서브쿼리의 결과가 0 건 이상인 경우
   - 다중행 비교연산자와 함께 사용
     IN, ALL, ANY, SOME, EXISTS
```
```다중행 컬럼 서브쿼리
   - 서브쿼리의 조회 컬럼이 2개 이상인 경우
   - 메인 쿼리의 조건 절에서 여러 컬럼을 동시에 비교할 수 있다
   - 메인 쿼리의 컬럼 수와 컬럼 순서가 동일해야 한다
```
3. 사용 위치에 따른 분류
```인라인 뷰 서브쿼리
  - FROM 절에  쓰는 서브쿼리
  - 테이블의 데이터가 너무 클 경우 서브쿼리로 먼저 데이터를 제한할 수 있다
```
```스칼라 서브쿼리
  - SELECT절에 쓰는 서브쿼리
  - JOIN 대신 SELECT에 서브쿼리를 써서 테이블을 조회할 수 있다
```

## 다중행 비교연산자
```1. IN
 메인쿼리의 비교조건이 서브쿼리 결과중에 하나라도 일치하면 참
 EX) salary IN (200, 300, 400) 샐러리가 200이거나 300이거나 400이어야 참
    250 IN (200, 300, 400) - 거짓
```
```2. ANY, SOME 
 메인쿼리의 비교조건이 서브쿼리의 검색결과 중 하나 이상 일치하면 참
 EX) salary > ANY (200, 300, 400) 샐러리가 200이나 300, 400보다 크면 참
     250 > ANY (200, 300, 400) - 참
```
```3. ALL
 메인쿼리의 비교조건이 서브쿼리의 검색결과와 모두 일치하면 참
 EX) salary > ANY (200, 300, 400) 샐러리가 200보다 크고 300보다 크코 400보다 커야 참
     250 > ALL (200, 300, 400) - 거짓
```
```4. EXISTS
 - 메인쿼리의 비교조건이 서브쿼리의 결과 중 만족하는 값이 하나라도 존재하면 참
SELECT A.dept_cd, A.dept_nm
FROM tb_dept A
WHERE EXISTS ( -- 이 서브쿼리의 결과로 참이 나오는 행은 반환
             SELECT 1                -- 공집합인지 아닌지만 확인, 컬럼은 상관없다
             FROM tb_emp B           -- tb_emp 테이블에서 
             WHERE addr LIKE '%강남%' -- 주소가 %강남% 형태이고
                 AND a.dept_cd = b.dept_cd
                                     -- tb_emp의 부서코드가 일치한다면 참
             )
```
